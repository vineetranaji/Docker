FROM node:18-alpine

WORKDIR /app

# Create package.json file inside the image
RUN echo '{ \
  "name": "my-node-app", \
  "version": "1.0.0", \
  "main": "server.js", \
  "scripts": { "start": "node server.js" }, \
  "dependencies": { "express": "^4.18.2" } \
}' > package.json

# Create an empty package-lock.json (optional but usually generated by npm)
RUN echo '{}' > package-lock.json

# Install dependencies based on package.json
RUN npm install --production

# Copy application files (including your server.js)
COPY . .

RUN echo "const express = require('express'); \
const app = express(); \
const port = 3000; \
app.get('/', (req, res) => res.send('Hello from Node in Docker!')); \
app.listen(port, () => console.log(\`Server running at http://0.0.0.0:\${port}\`));" > server.js


EXPOSE 3000

CMD ["node", "server.js"]
